%!TEX encoding = IsoLatin

%
% Chapitre "Fonctionnalites"
%

\chapter{Fonctionnalités}

\section{Image}
\subsection{Importation}

Pour satisfaire ce critère, l'application doit pouvoir importer des fichiers images (.jpg, .png, etc.) pour les utiliser à des fins de rendu graphique.  

L'application permet cette fonctionnalitée grâce à l'utilisation du bouton "Import". Celui-ci ouvre un navigateur de fichier qui permet à l'utilisateur de selectionner facilement le fichier image voulu. Cette image est placée dans le renderer 2D, initialement avec sa taille d'origine et à la position (0,0).

Les figures suivantes demontrent cette fonctionnalitée.

\begin{figure}[H] 
\begin{center}
\includegraphics[width=13cm, height=13cm]{fig/importExplorer.png}
\end{center}
\caption{Le bouton Import et son navigateur.}
\end{figure} 

\begin{figure}[H] 
\begin{center}
\includegraphics[width=13cm, height=13cm]{fig/importedImage.png}
\end{center}
\caption{Une image importée dans le renderer 2D.}
\end{figure}

\begin{figure}[H] 
\begin{center}
\includegraphics[width=13cm, height=13cm]{fig/importCode.png}
\end{center}
\caption{Code important de la fonctionnalitée Import.}
\end{figure}

\subsection{Exportation}

Pour satisfaire ce critère, l'application doit pouvoir exporter des fichiers images (dans notre cas une image .png) et de la sauvegarder sur l'ordinateur utilisé.

L'application permet cette fonctionnalitée grâce à l'utilisation du bouton "Export". Celui-ci ouvre un navigateur de fichier qui permet à l'utilisateur de choisir facilement l'emplacement de sauvegarde ainsi que le nom du fichier sauvegardé. Cette image est celle rendue sur le renderer 2D.

Les figures suivantes demontrent cette fonctionnalitée.

endue sur le renderer 2D.

Les figures suivantes demontrent cette fonctionnalitée.

\begin{figure}[H] 
\begin{center}
\includegraphics[width=13cm, height=13cm]{fig/exportExplorer.png}
\end{center}
\caption{Le bouton Export et son navigateur.}
\end{figure}

\begin{figure}[H] 
\begin{center}
\includegraphics[width=13cm, height=13cm]{fig/exportedImage.png}
\end{center}
\caption{Une image exportée à partir de l'application Paint3D+.}
\end{figure}

\begin{figure}[H] 
\begin{center}
\includegraphics[width=13cm, height=13cm]{fig/exportCode.png}
\end{center}
\caption{Code important de la fonctionnalitée Export.}
\end{figure}

\section{Dessin vectoriel}
\subsection{Curseur dynamique}
L'application permet un affichage dynamique du curseur de façon à ce que l'utilisateur obtienne une rétroaction visuelle lors de ses actions. Le curseur est représenté différemment que ce soit pour chacune des formes 2D que l'utilisateur ajoute ou pour l'ensemble des opérations de transformation. De plus, le curseur redevient normal lorsque situé au dessus des panneaux de configuration de l'interface graphique. Pour ce faire, la fonction dessinant le curseur vérifie quel mode de dessin est sélectionné ou quelle action est effectuée.

Les figures ci-dessous démontrent la présence de la fonctionnalité.

\begin{figure}[H]
 \centering
 \includegraphics[scale=0.7]{fig/Cursors.png}
	\caption{Curseur dynamique - Ligne, triangle, rectangle et cercle}
 \label{fig:f_cursor1}
\end{figure}

\begin{figure}[H]
 \centering
 \includegraphics[scale=0.7]{fig/Cursors2.png}
	\caption{Curseur dynamique - Translation, redimensionnement et rotation}
 \label{fig:f_cursor2}
\end{figure}

\begin{figure}[H]
 \centering
 \includegraphics[scale=0.7]{fig/drawCursor.png}
	\caption{Exemple de code pour la fonctionnalité}
 \label{fig:f_cursorCode}
\end{figure}

\subsection{Formes vectorielles}
L’application Paint3D+ permet de créer des quatre instances de formes, soit des lignes, des triangles, des rectangles ou bien des cercles. Les paramètres sont établis par l'utilisateur et envoyés à l'application qui appel au final les méthodes de base de OpenFrameworks. De plus, il est possible de créer un ensemble de plusieurs primitives vectorielles en sélectionnant les primitives désirées et en appuyant sur le bouton Merge Shapes. La manière de procéder consiste à regrouper les différentes formes sélectionnées dans un vecteur et créer un nouvel objet.

La figure ci-dessous démontre le code afin de dessiner un objet 2D regroupant plusieurs primitives.

\begin{figure}[H]
 \centering
 \includegraphics[scale=0.7]{fig/drawCollection.png}
	\caption{Exemple de code pour le dessin de collection d'objets}
 \label{fig:f_collectionCode}
\end{figure}

\subsection{Interface}
Au niveau de l'interface graphique, l'application permet d'offrir des contrôles interactifs en plus de donner de une rétroaction à l’utilisateur. En effet, comme il est possible de voir sur les différentes figures présentes dans ce rapport, des panneaux de configuration des différentes instances de formes permettent d'ajuster chacun des paramètres de celles-ci. Lors de la fonction setup, des instances (boutons, panneaux, etc.) dérivant de la classe OfxGui sont ajoutés à la fenêtre de l'application. 

\section{Transformation}

\subsection{Structure de la scène}

Toutes les entités géométriques présentes dans une scène sont organisées dans une ou des structures de données qui permettent de gérer les transformations et le rendu graphique de chaque élément.

Dans notre application, la structuration des entités géométriques est faite sous forme de vecteurs (un vecteur pour le 2D et un pour le 3D). La recherche d'une entitée particulière est donc faite en parcourant les vecteurs au complet.

\begin{figure}[H] 
\begin{center}
\includegraphics[width=13cm, height=13cm]{fig/structureCode.png}
\end{center}
\caption{Code important de la fonctionnalitée Structure de scène.}
\end{figure}

Pour le mode 3D de l'application, il est possible de sélectionner chaque Primitive 3D en appuyant sur le bouton ''Select next 3d shape''. Une fois sélectionnée, il est possible de sa couleur de remplissage, sa position en x, y, z, son orientation en x, y, z, de la supprimer et de la transformer en nuage de points.

Cela est possible grâce à une structure vector<Obj3D*> qui contient toutes les classes dérivées de Obj3D comme le cube ou la sphère. Voici un exemple de code le montrant:

\newpage

\begin{figure}[h] 
\begin{center}
\includegraphics[width=16cm, height=7cm]{fig/transformations3d1.png}
\end{center}
\caption{Structure de données stockant les entités 3D.}
\end{figure}

\begin{figure}[h] 
\begin{center}
\includegraphics[width=16cm, height=7cm]{fig/transformations3d2.png}
\end{center}
\caption{Méthode montrant comment on stock une nouvelle entité 3D dans vector<Obj3D*>.}
\end{figure}

\newpage 

\subsection{Transformation interactive}

Il est possible de modifier interractivement la translation, la rotation et le redimensionnement de tous les objets présents dans la scène.

Pour les transformations 2D, le code de ceux-ci à été fait au complet. L'utilisation des fonctions prédéfinie de openframeworks est seulement présente pour les images importées. Dans les autres cas, soit des paramètres de taille sont changés (width, height et radius) ou soit les coordonnées des coins et/ou du point milieu. Les transformations de redimensionnement et de rotation sont faites par rapport au point milieu de la structure (moyenne des coins/points critiques). Pour ce qui est des objets 3D, la translation est faite par position de openframeworks et l'orientation par quaternion, une fonctionnalité de openframeworks.

\begin{figure}[H] 
\begin{center}
\includegraphics[width=13cm, height=13cm]{fig/transformations.png}
\end{center}
\caption{Translation, rotation et redimensionnement d'un rectangle.}
\end{figure}

\begin{figure}[H] 
\begin{center}
\includegraphics[width=13cm, height=13cm]{fig/transformationCode1.png}
\end{center}
\caption{Code important des fonctionnalitées de transformation.}
\end{figure}

\begin{figure}[H] 
\begin{center}
\includegraphics[width=13cm, height=13cm]{fig/resizeCode.png}
\end{center}
\caption{Code important de la fonctionnalité de redimensionnement.}
\end{figure}

\begin{figure}[H] 
\begin{center}
\includegraphics[width=13cm, height=13cm]{fig/translateCode.png}
\end{center}
\caption{Code important de la fonctionnalité de translation.}
\end{figure}

\begin{figure}[H] 
\begin{center}
\includegraphics[width=13cm, height=13cm]{fig/rotateCode.png}
\end{center}
\caption{Code important de la fonctionnalité de rotation.}
\end{figure}

En mode 3D, il est possible de changer la position x, y, z, l'orientation en x, y, z et le redimensionnement grâce aux paramètres glissant de la fenêtres ''3D Settings''.
\\

\noindent Voici le images le montrant:

\begin{figure}[H] 
\begin{center}
\includegraphics[width=13cm, height=13cm]{fig/transf3d1.png}
\end{center}
\caption{Image de référence.}
\end{figure}

\begin{figure}[H] 
\begin{center}
\includegraphics[width=13cm, height=13cm]{fig/transf3d2.png}
\end{center}
\caption{Changement de Position.}
\end{figure}

\begin{figure}[H] 
\begin{center}
\includegraphics[width=13cm, height=13cm]{fig/transf3d3.png}
\end{center}
\caption{Changement d'orientation.}
\end{figure}

\begin{figure}[H] 
\begin{center}
\includegraphics[width=13cm, height=13cm]{fig/transf3d4.png}
\end{center}
\caption{Redimensionnement.}
\end{figure}

\newpage 

De plus, pour méthodes s'occupant de faire la rotation aux primitives 3D, les quaternions sont utilisés pour leur côté pratique et éviter tout blocage de cardan:

\begin{figure}[H] 
\begin{center}
\includegraphics[width=14cm, height=10cm]{fig/quaternions.png}
\end{center}
\caption{Exemple de code contenant des quaternions.}
\end{figure}

\subsection{Sélection multiple}

Il est possible de sélectionner une ou des instances d'entités visuelles présentes dans la scène et de modifier les attributs qu'elles ont en commun même si elles sont de différents types. Ces entités peuuvent même être rassemblées pour créer un nouvel object appelé Obj2DCollection. Cette collection emmagasine les structures selectionnées dans un nouveau vecteur.

\begin{figure}[H] 
\begin{center}
\includegraphics[width=13cm, height=13cm]{fig/selection.png}
\end{center}
\caption{Objet original, modifications à l'aide d'une sélection multiple et modifications après un collage en Obj2DCollection.}
\end{figure}

\begin{figure}[H] 
\begin{center}
\includegraphics[width=13cm, height=13cm]{fig/containedCode.png}
\end{center}
\caption{Code important de la fonctionnalité de selection multiple.}
\end{figure}

\begin{figure}[H] 
\begin{center}
\includegraphics[width=13cm, height=13cm]{fig/selectMultipleCode1.png}
\end{center}
\caption{Code important de la fonctionnalité de selection multiple.}
\end{figure}

\begin{figure}[H] 
\begin{center}
\includegraphics[width=13cm, height=13cm]{fig/selectMultipleCode2.png}
\end{center}
\caption{Code important de la fonctionnalité de selection multiple.}
\end{figure}

\section{Géométrie}




\subsection{Particules}

Pour respecter ce critère fonctionnel, l'application doit rendre un nuage de points en une seule commande d'affichage.
\\

Dans l'application Paint3D+,  il y a un bouton nommé ''Cloud Points'' qui permet de transformer un objet 3D sélectionné en  un nuage de points où chaque point est un sommet d'unedes faces qui compose l'objet en 3D.
\\

Donc, pour pouvoir utiliser cette option, il faut créer un objet 3D avec le bouton ''Cube'' ou ''Sphere'' en mode 3D, sélectionner un des objets 3D créé avec le bouton ''Select next 3D Shape'' et appuyer sur le bouton ''Cloud Points'' pour rendre l'objet 3D sélectionné en tant que nuage de points.
\\

Les 2 figures suivantes montrent une sphère rendue sans nuage de points et une sphère rendue avec un nuage de points.

\newpage

\begin{figure}[h] 
\begin{center}
\includegraphics[width=13cm, height=13cm]{fig/cloudpoints1.png}
\end{center}
\caption{Une sphère rendue sans nuage de points.}
\end{figure}
 
 
\begin{figure}[h] 
\begin{center}
\includegraphics[width=13cm, height=13cm]{fig/cloudpoints2.png}
\end{center}
\caption{Une sphère rendue avec un nuage de points.}
\end{figure}

\newpage

\subsection{Primitives 3D}

L'application doit permettre de créer au moins 2 types de primitives géométriques 3D à partir d'un algorithme sans aucune données externes à l'application.
\\

L'application Paint3D+ permet de créer 2 primitives 3D localement sans données externes, soit le cube et la sphère. Ces 2 primitives 3D sont créées par composition à partir de 2 classes d'OpenFrameworks, soit OfSpherePrimitive et OfxBoxPrimitive. 
\\

Pour créer ces 2 primitives 3D, il faut d'abord sélectionner le mode 3D dans le menu. Ensuite, il faut cocher soit Cube ou Sphere, selon la primitive 3D à créer et cliquer gauche sur la souris à l'endroit où l'on veut que la primitive 3D apparaisse. Une fois crée, chaque primitive 3D a une profondeur par défaut de 30 unités. Cela permet de mettre en valeur l'effet de perspective et bien montrer qu'il s'agit d'un objet en 3D. Ensuite, pour modifier une primitive 3D créée, il faut la sélectionner avec l'option ''Select next 3D shape'' et modifier les paramètres modifiables, soit la position en x,y,z l'orientation en x,y,z ou la couleur de sélection ou de remplissage. De plus, lorsqu'une primitive 3D est sélectionnée, il est possible de l'effacer en appuyant sur la touche ''delete''. 
\\

Il est à noter que la rotation est faite à partir de quaternions dans le code.
\\

Les 2 figures suivantes montrent les 2 primitives 3D que l'application peut créer sans données externes.

\newpage

\begin{figure}[h] 
\begin{center}
\includegraphics[width=13cm, height=13cm]{fig/primitives3d1.png}
\end{center}
\caption{Une primitive 3D d'un cube.}
\end{figure}

\begin{figure}[h] 
\begin{center}
\includegraphics[width=13cm, height=13cm]{fig/primitives3d2.png}
\end{center}
\caption{Une primitive 3D d'une sphère.}
\end{figure}

\newpage 

\subsection{Modèle}

L'application permet de créer une ou des instances de modèles 3D à partir d'un maillage géométrique importé à partir d'un fichier externe.
\\

Dans le mode ''Model'', l'application permet d'importer un maillage géométrique et d'afficher une instance de modèle3D. Les maillages peuvent être stockés dans les dossiers /bin/data. Pour cette version de l'application, l'utilisateur ne peut qu'activer ou désactiver la lumière, le matériau et la texture (si elle existe). Ce mode est à développer dans la prochaine version du projet.
\newpage

\begin{figure}[h] 
\begin{center}
\includegraphics[width=13cm, height=13cm]{fig/gun1.jpg}
\end{center}
\caption{Exemple de modèle par un fichier externe contenant un maillage.}
\end{figure}
             
\newpage
\begin{figure}[h]
\begin{center}
\includegraphics[width=13cm, height=13cm]{fig/gun2.jpg}
\end{center}
\caption{Exemple de modèle par un fichier externe contenant un maillage.}
\end{figure}

\newpage
\section{Illumination}


\subsection{Modèle d'illumination}

Le rendu des entités visuelles est fait à partir d'un modèle d'illumination qui supporte au moins une combinaison de lumière dynamique et de matériau.
\\

Dans l'application Paint 3D+,  on utilise, pour la partie du projet ''Model 3D'', la lumière standard (specularlight) et le modèle ''shade'' de OpenGl (GL\_SMOOTH) pour rendre les fichiers modèles en 3D. On peut enlever la lumière et les matériaux des objets avec les touches correspondantes. 

\newpage

\begin{figure}[h] 
\begin{center}
\includegraphics[width=13cm, height=13cm]{fig/mod.jpg}
\end{center}
\caption{Image représentant comme est traitée et réfléchie la lumière avec l'utilisation du shader ''shade'' de OpenGl (GL\_SMOOTH) }
\end{figure}
\newpage

%===========================TP3===============================================================

\newpage


\section{Caméra}

Dans l'application Paint3d+, une caméra interractive peut être activée en appuyant sur le bouton ''Camera'' dans la fenêtre des paramètres 3D. Il faut toutefois être en mode ''3D'' pour pouvoir activer la caméra.

\subsection{Caméra interactive}

En appuyant sur le bouton ''Camera'' en mode 3D, la fenêtre du programme affiche la scène du point de vue de la caméra. Donc, tous les objets de la scène sont transformés pour être rendus du point de vue de la caméra.
\\
\\ 
Au départ, la caméra est initialisée à la position ''(ofGetWidth()/2, ofGetHeight()/2, 1000)''. Cela veut dire que la position par défaut de la caméra est au milieu de l'écran à une distance de 1000 pixels dans l'axe des z de l'espace de la scène. Visuellement, en mode Camera 3D, la scène devient comme celle décrit dans la figure \ref{camerainit}.

\newpage

\begin{figure}[h] 
\begin{center}
\includegraphics[width=13cm, height=13cm]{fig/camerainit.png}
\end{center}
\caption{Rendu du point de vue la caméra au moment où elle est initialisée. }
\label{camerainit}
\end{figure}
\newpage

Une fois en mode ''Camera'', il est possible d'ajuster l'orientation et la position de la camera avec les touches du clavier décrits dans la figure \ref{cam2}. Grosso modo, ce sont les flèches du clavier et les touches ''w'', ''a'', ''s'', ''d'',''r'', ''f'', '','' et  ''.'' qui permettent respectivement de se déplacer vers l'avant, la gauche, le bas, la droite, le haut et le bas. Les flèches du clavier, quant à elles, changent l'orientation de la vue da la caméra. Il est également possible d'orienter la vue de la caméra avec la souris et son firstButton. Les figures  \ref{cam3} et \ref{cam4} montrent un peu les différentes navigations interractives qu'il est possible de faire avec la caméra et leurs effets sur le rendu final.

\newpage
\begin{figure}[h] 
\begin{center}
\includegraphics[width=13cm, height=13cm]{fig/cam2.png}
\end{center}
\caption{Touches à utiliser pour modifier la caméra}
\label{cam2}
\end{figure}
\newpage

\newpage
\begin{figure}[h] 
\begin{center}
\includegraphics[width=13cm, height=13cm]{fig/cam3.png}
\end{center}
\caption{Rendu du point de vue de la ccaméra après s'être déplacé.}
\label{cam3}
\end{figure}
\newpage

\newpage
\begin{figure}[h] 
\begin{center}
\includegraphics[width=13cm, height=13cm]{fig/cam4.png}
\end{center}
\caption{Rendu du point de vue de la caméra après avoir changé interractivement l'orientation et la position de la caméra}
\label{cam4}
\end{figure}
\newpage

\subsection{Propriétés de caméra}

Avec les paramètres décrits dans la figure \ref{cam5}, il est également possible de changer les paramètres de la caméra tels que le type de projection (orthogonal, projectif), l'angle de champ de vision (horizontal et vertical), le ratio d'aspect et la distance du plan de clipping avant et arrière. 

\newpage
\begin{figure}[h] 
\begin{center}
\includegraphics[width=13cm, height=13cm]{fig/cam5.png}
\end{center}
\caption{Description des différents paramètres modifiables sur la caméra.}
\label{cam5}
\end{figure}
\newpage

Les figures qui suivent montrent l'effet de changer les paramètres décrits précédemment.

\begin{figure}[h] 
\begin{center}
\includegraphics[width=13cm, height=13cm]{fig/camref.png}
\end{center}
\caption{Rendu du point de vue de la caméra après initial avec tous les paramètres mis à leur valeur par défaut}
\label{camref}
\end{figure}
\newpage


\newpage
\begin{figure}[h] 
\begin{center}
\includegraphics[width=13cm, height=13cm]{fig/camortho.png}
\end{center}
\caption{Rendu du point de vue de la caméra après avoir mis le type de projection à orthogonal}
\label{camortho}
\end{figure}
\newpage

\newpage
\begin{figure}[h] 
\begin{center}
\includegraphics[width=13cm, height=13cm]{fig/camfov.png}
\end{center}
\caption{Changement du champ de vision de la caméra (fov)}
\label{camfov}
\end{figure}
\newpage

\newpage
\begin{figure}[h] 
\begin{center}
\includegraphics[width=13cm, height=13cm]{fig/camratio.png}
\end{center}
\caption{Rendu du point de vue de la caméra après avoir changé interractivement l'aspect ratio}
\label{camratio}
\end{figure}


\subsection{Caméras multiples}

Dans l'application Paint3D+, il est possible d'ajouter plus d'une caméra dans une même scène et de changer de camera lorsqu'on est en mode ''Camera'' et qu'il y a plus qu'une caméra dans la scène. Plus précisément, avec le touche clavier ''c'', on crée une nouvelle caméra, avec la touche clavier ''v'', on change de caméra et avec la touche clavier ''b'', on efface la caméra qui est en cours d'utilisation.
\\
\\
Dans les 2 figures suivantes, on montre le texte expliquant à quoi servent les 3 touches décrites ci-haut et on voit aussi la même scène, mais rendue par 2 caméras différentes.

\newpage
\begin{figure}[h] 
\begin{center}
\includegraphics[width=13cm, height=13cm]{fig/multiplecambutton.png}
\end{center}
\caption{Texte décrivant à quoi servent les touches clavier ''c'', ''v'' et ''b''. On voit aussi une scène 3D composée de 3 cubes selon le point de vue de la caméra 1.}
\label{mutliplecambutton}
\end{figure}


\newpage
\begin{figure}[h] 
\begin{center}
\includegraphics[width=13cm, height=13cm]{fig/multiplecam2.png}
\end{center}
\caption{Rendu du point de vue de la caméra 2 de la scène 3D comportant 3 cubes de la figure précédente}
\label{multiplecam2}
\end{figure}



\section{Rastérisation}

	\subsection{Texture d’élévation (height map)}
	Tel que le démontre la figure \ref{fig:f_heightMap}, il est possible d'appliquer une texture d'élévation à partir du logiciel Paint3D+. L'image utilisée pour cette texture est représentée à la figure \ref{fig:f_heightMapSrc}. Un maillage géométrique (\og Mesh \fg{}) est créé en ajoutant des faces à ce dernier. Les faces sont elles-même créées en fonction de quatre sommets définis selon chaque pixel x,y de l'image et de l'indice de luminosité à cet endroit. On procède donc à un surélèvement de l'image selon l'indice de luminosité de chaque pixel. Il est possible de voir une partie de code qui implémente cette fonction à la figure \ref{fig:f_heightMapCode}
	 
	\begin{figure}[H]
 		\centering
	 	\includegraphics[scale=0.4]{fig/heightMap.png}
		\caption{Résultat de texture d’élévation}
		 \label{fig:f_heightMap}
	\end{figure}
	
	\begin{figure}[H]
 		\centering
	 	\includegraphics[scale=0.95]{fig/heightMapSrc.jpg}
		\caption{Image source pour la texture d'élévation}
		 \label{fig:f_heightMapSrc}
	\end{figure}
	
	\begin{figure}[H]
 		\centering
	 	\includegraphics[scale=0.7]{fig/heightMapCode.png}
		\caption{Code pour la texture d’élévation}
		 \label{fig:f_heightMapCode}
	\end{figure}
	
	De plus, une fonction de displacement mapping a été ajouté pour répliquer le heightmap sur les formes géométriques.
	
	\begin{figure}[H]
 		\centering
	 	\includegraphics[width=13cm, height=13cm]{fig/displacementMap.png}
		\caption{Résultat du displacement mapping sur un cube}
		 \label{fig:f_displacementMap}
	\end{figure}

\subsection{Texture de variation de normale (normal map)}
\subsection{Cube de réflexion (cube map)}
Comme on peut le voir sur la figure \ref{fig:f_cubeMap}, une option pour appliquer une texture cubeMap est disponible. L'image à la figure \ref{fig:f_cubeMapImages} est séparée en 6(haut, bas, gauche, droite, avant, arrière) et est ensuite appliqué à une forme géométrique grâce à un shader.

	\begin{figure}[H]
 		\centering
	 	\includegraphics[scale=0.4]{fig/cubeMapImages.jpg}
		\caption{Image de base du cubemap}
		 \label{fig:f_cubeMapImages}
	\end{figure}
	
	\begin{figure}[H]
 		\centering
	 	\includegraphics[width=13cm, height=13cm]{fig/cubeMap.png}
		\caption{Résultat du cube mapping sur une sphère}
		 \label{fig:f_cubeMap}
	\end{figure}

\newpage


\section{Courbes et surfaces}

Dans l'application Paint3D+, il est possible de tracer des courbes ou surfaces paramétriques à l'aide de points de contrôle. Les points de contrôle sont stockés dans une structure vector qui les accumule. Pour ajouter un nouveau point de contrôle, il suffit de créer une sphère (ou un cube), de le placer à la position qu'on veut et d'appuyer sur ''Control Points''. Ainsi, la position de la sphère (ou du cube) est ajoutée au vector contenant les points de contrôle. 

\subsection{Courbe paramétrique}

Après avoir accumulé 4 points de contrôle ou plus, il est possible de créer et de rendre une courbe de Bézier Cubique, une courbe Nurbs ou encore une courbe de Catmull-Rom. Pour ce faire, il suffit d'appuyer sur respectivement les boutons, ''Bezier Cubique Curve'', ''Nurbs Curve'' ou ''CatmullRom Curve''.
\\
\\ 
Les figures qui suivent montrent ces courbes construites à partir des points de contrôle (tous supérieurs à 4) représentés par les sphères rouges.

\newpage
\begin{figure}[h] 
\begin{center}
\includegraphics[width=13cm, height=13cm]{fig/curvebezier1.png}
\end{center}
\caption{5 points de contrôles (ces points de contrôles ont été ajoutés avec le bouton Control Points après avoir sélectionné chacun des sphères) }
\label{curvebezier1}
\end{figure}
\newpage

\begin{figure}[h] 
\begin{center}
\includegraphics[width=13cm, height=13cm]{fig/curvebezier2.png}
\end{center}
\caption{Courbe de Bézier Cubique rendue à partir des 5 points de contrôle de la figure précédente}
\label{curvebezier2}
\end{figure}
\newpage

\begin{figure}[h] 
\begin{center}
\includegraphics[width=13cm, height=13cm]{fig/curvenurbs1.png}
\end{center}
\caption{Courbe NURBS rendue à partir des 6 points de contrôle montrés dans la figure}
\label{curvenurbs1.png}
\end{figure}
\newpage

\begin{figure}[h] 
\begin{center}
\includegraphics[width=13cm, height=13cm]{fig/curvecatmull1.png}
\end{center}
\caption{Courbe de Catmull-Rom rendu à partir des 6 points de contrôle montrés dans la figure}
\label{curvecatmull1.png}
\end{figure}
\newpage



\subsection{Surface paramétrique}

Dans l'application Paint3D+, il est possible de rendre 2 surfaces paramétriques. Une surface de Bézier Bicubique et une surface de Coons.
\\
\\
Pour créer et rendre une surface de Bézier Bicubique, il suffit d'accumuler un nombre de points de contrôle dont la racine carrée est un nombre entier (1, 4, 9, 16, etc.) et de cliquer sur le bouton ''Bezier Cubique Surface''. De plus, il est important de respecter l'ordre suivant pour les points de contrôle: Ajouter les points rangée par rangée ou colonne par colonne. Exemple: ((1, 1),(2, 1), (3, 1), (2, 1), (2, 2), (2, 3), (3, 1), (3, 2), (3, 3)). Si cet ordre n'est pas respecté, la surface risque d'être dégénérée ou invalide.
\\
\\
Pour créer et rendre une surface de Coons, comme décrit dans les notes de cours, il suffit d'identifier 4 courbes en 3D qui forment un contour fermé et le frontière de la surface de Coons. Dans l'application Paint3D+, ce défi a été accompli en choisissant de prendre 12 points de contrôle pour construire une surface de Coons. Voici comment: On place 12 sphères de façon à ce qu'elles forment un contour fermé en 3D. Ensuite, les sphères 1, 2, 3 et4 forment la première courbe du contour fermé., les sphères 4, 5, 6 et 7 forment la 2e courbe du contour fermé, les sphères 7, 8, 9 et 10 forment la 3e courbe du contour fermé et les sphères 10, 11, 12 et 1 forment la 4e courbe du contour fermé. Ensuite, un algorithme s'occupe d'extraire ces 4 courbes et de construire la surface Coons. Il est primordial ici que les 12 sphères soient placées en sens horaire ou anti-horaire et qu'elles se suivent. De la même façon, on doit ajouter les points de contrôle (à partir des sphères ou cubes avec le bouton Control Points) avec ce \textbf{même ordre}. Si l'ordre n'est pas respectée, la surface de Coons, sera, évidemment, dégénérée et invalide.
\\
\\
Les figures qui suivent montrent une surface de Bézier Bicubique et une surface de Coons construites de la façon décrite ci-dessus.

\newpage

\begin{figure}[h] 
\begin{center}
\includegraphics[width=13cm, height=13cm]{fig/surfacebezier1.png}
\end{center}
\caption{Surface de Bézier Bicubique construite à partir des 9 points de contrôle montrés dans la figure}
\label{surfacebezier1.png}
\end{figure}
\newpage

\newpage

\begin{figure}[h] 
\begin{center}
\includegraphics[width=13cm, height=13cm]{fig/surfacecoons1.png}
\end{center}
\caption{Surface de Coons construite à partir des 12 points de contrôle formant un contour fermé montrés dans la figure}
\label{surfacecoons1.png}
\end{figure}
\newpage

\subsection{Shader de tesselation}

Dans l'application Paint3D+, il y a un paramètre en mode 3D qui se nomme ''Tesselation''.
C'est un paramètre dont la valeur est ajustable de $0$ à $100$. Pour la courbe de Bézier Cubique, la courbe NURBS, la courbe de Catmull-Rom et la surface de Bézier Bicubique, le paramètre de tesselation sert à déterminer la largeur du pas utilisé pour incrémenter le paramètre ''t'', (''u'' et ''v'' dans le cas de la surface de Bézier Bicubique) qui varie de $0$ à $1$. En fait, la largeur de pas est déterminée ainsi:
\[
largeur\_pas = 1/(floor(Tesselation) +1)
\]

Ainsi, plus la tesselation est élevée, plus les éléments découpés pour former la courbe paramétrique ou la surface paramétrique seront fins et donc plus la courbe ou la surface sera lisse et fine.
\\
\\
Quant à la surface de Coons, la tesselation sert plutôt à indiquer combien de fois sous-diviser le maillage triangulaire qui recouvre la surface de Coons. Pour des raisons de calculs et de performances, nous avons limité le nombre de sous-divisions à 1 (triangles originaux), 2 et 3 avec la relation suivante:
\[
	Si ~tesselation~\epsilon~[0,33[~\Rightarrow nombre\_sous\_division= 1
	\]
	\[
	Si ~tesselation~\epsilon~[33,66[~\Rightarrow nombre\_sous\_division= 2
	\]
	\[
	Si ~tesselation~\epsilon~[66,100[~\Rightarrow nombre\_sous\_division= 3
\]

Ensuite, la sous-division du maillage triangulaire est fait dans les fonctions ''surfaceTesselation4()'' et ''surfaceTesselation5()'' selon l'algorithme de sous-division de surface de Catmull-Clark décrit dans les notes de cours à la page 137.
\\
\\
Les figures suivantes montrent une courbe de Bézier cubique et une surface de Coons avec différents niveau de tesselation. Pour les autres courbes , c'est le même principe.

\newpage

\begin{figure}[h] 
\begin{center}
\includegraphics[width=13cm, height=13cm]{fig/beziertess1.png}
\end{center}
\caption{Courbe de Bézier Cubique avec une tesselation de $2.04$}
\label{beziertess1.png}
\end{figure}
\newpage


\begin{figure}[h] 
\begin{center}
\includegraphics[width=13cm, height=13cm]{fig/beziertess2.png}
\end{center}
\caption{Courbe de Bézier Cubique avec une tesselation de $4.08$}
\label{beziertess2.png}
\end{figure}
\newpage

\begin{figure}[h] 
\begin{center}
\includegraphics[width=13cm, height=13cm]{fig/beziertess3.png}
\end{center}
\caption{Courbe de Bézier Cubique avec une tesselation de $7.14$}
\label{beziertess3.png}
\end{figure}
\newpage


\begin{figure}[h] 
\begin{center}
\includegraphics[width=13cm, height=13cm]{fig/surfacecoons1.png}
\end{center}
\caption{Surface de Coons avec une tesselation de $1$}
\label{surfacecoons1}
\end{figure}
\newpage


\begin{figure}[h] 
\begin{center}
\includegraphics[width=13cm, height=13cm]{fig/surfacecoons2.png}
\end{center}
\caption{Surface de Coons avec une tesselation de $1$}
\label{surfacecoons2}
\end{figure}
\newpage


\begin{figure}[h] 
\begin{center}
\includegraphics[width=13cm, height=13cm]{fig/surfacecoons3.png}
\end{center}
\caption{Surface de Coons avec une tesselation de $1$}
\label{surfacecoons3}
\end{figure}
\newpage

\newpage
\section{Lancer de rayon}
\subsection{Ombrage}

L'ombrage dans notre application est implémenté dans le mode modèle. Ici est mise en place une caméra interactive, une lumière (dynamique pour mieux observer l'effet d'ombrage). On a implémenté des murs pour remarquer l'effet d'ombrage sur la scène. On a une source lumineuse ponctuelle. Les rayons émis divergent radialement de la source. La position de la lumière se change. Avec la caméra interactive, on peut voir comment l'ombrage est rendu de différents points de vue. De plus, le modèle qui peut être importé de cette interface peut être déplacé sur l'axe de x, y, et z. Une rotation peut être appliquée au modèle. On présente des images correspondantes au l'effet d'ombrage :

	\begin{figure}[H]
 		\centering
	 	\includegraphics[width=13cm, height=13cm]{fig/ombrage1.PNG}
		\caption{Ombrage dans le mode model}
		 \label{fig:ombrage}
	\end{figure}

	\begin{figure}[H]
 		\centering
	 	\includegraphics[width=13cm, height=13cm]{fig/ombrage2.PNG}
		\caption{Ombrage dans le mode model}
		 \label{fig:f_ombrage}
	\end{figure}

\newpage
\subsection{Rendu graphique}

Un algorithme de lancer de rayon a été utilisé pour projeter l?ombre des objets qui se trouve en face de la source de lumière. On a utilisé la version plus minimaliste de raytracing. Les rayons sont lancés à partir de la source de lumière dans la direction de chaque pixel de la fenêtre d?affichage. L?illumination locale s?évalue au point d?intersection entre la lumière et la surface. On voit dans la figure plus bas que si on positionne le modèle entre la lumière et la sphère la deuxième est affecter par l?ombrage (ce qui était attendu) :

	\begin{figure}[H]
 		\centering
	 	\includegraphics[width=13cm, height=13cm]{fig/ombrage3.PNG}
		\caption{Ombrage dans le mode model}
		 \label{fig:f_ombrage}
	\end{figure}

\newpage
\subsection{Réfraction}

\newpage
\section{Techniques de rendu}
\subsection{Shader de géométrie}
Des shaders sont utilisés pour rendre les formes affectées par le cube mapping\ref{fig:f_cubeMap} et le displacement mapping\ref{fig:f_displacementMap}. 

Voici les shaders de vertex et de fragments utilisés.

	\begin{figure}[H]
 		\centering
	 	\includegraphics[width=13cm, height=13cm]{fig/shaderCV.png}
		\caption{Shader de vertex du cubemap}
		 \label{fig:f_shaderCV}
	\end{figure}
	
	\begin{figure}[H]
 		\centering
	 	\includegraphics[width=13cm, height=13cm]{fig/shaderCF.png}
		\caption{Shader de fragment du cubemap}
		 \label{fig:f_shaderCF}
	\end{figure}
	
	\begin{figure}[H]
 		\centering
	 	\includegraphics[width=13cm, height=13cm]{fig/shaderHV.png}
		\caption{Shader de vertex du displacement map}
		 \label{fig:f_shaderHV}
	\end{figure}
	
	\begin{figure}[H]
 		\centering
	 	\includegraphics[width=13cm, height=13cm]{fig/shaderHF.png}
		\caption{Shader de fragment du displacement map}
		 \label{fig:f_shaderHF}
	\end{figure}

\subsection{BRDF}
\subsection{Effet visuel en post-process}
L'interface graphique propose à l'utilisateur une option afin de permettre l'activation ou la désactivation de l'anti-crénelage de l'ensemble de la surface de rendu et des objets qui s'y retrouve. Cela est possible pour n'importe quel mode, que ce soit 2D ou 3D.

Voici quelques captures d'écran afin de le démontrer. Toutefois, il est plus facile de le voir lors de l'utilisation du logiciel que sur des images.

\begin{figure}[H]
 \centering
 \includegraphics[scale=0.4]{fig/AntialisingOff.png}
	\caption{2D - Anti-crénelage désactivé}
 \label{fig:f_anti1}
\end{figure}

\begin{figure}[H]
 \centering
 \includegraphics[scale=0.4]{fig/AntialisingOn.png}
	\caption{2D - Anti-crénelage activé}
 \label{fig:f_anti2}
\end{figure}

\begin{figure}[H]
 \centering
 \includegraphics[scale=0.6]{fig/AntialisingOff2.png}
	\caption{3D - Anti-crénelage désactivé}
 \label{fig:f_anti3}
\end{figure}

\begin{figure}[H]
 \centering
 \includegraphics[scale=0.6]{fig/AntialisingOn2.png}
	\caption{3D - Anti-crénelage activé}
 \label{fig:f_anti4}
\end{figure}

